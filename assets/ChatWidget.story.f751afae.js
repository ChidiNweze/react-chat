import{r as u,j as C}from"./jsx-runtime.b12b884a.js";import{r as $}from"./index.66846199.js";import{c as A,a as b,C as x,K as W,U as z,o as _,S as V}from"./index.c46bc6ce.js";import"./index.5f93c6c9.js";import{B as E}from"./index.f4f8e8fd.js";import"./index.c237ccb4.js";import"./index.f4532c92.js";import"./index.28865da0.js";import"./index.9c26e9b2.js";import"./index.f17879ab.js";import"./index.f461c1a9.js";import"./index.0e26e6ce.js";import{L as M}from"./index.ced0f33c.js";import"./index.487efcde.js";import"./index.8cdbc5f1.js";import"./index.9b3b8351.js";import"./index.5a350aa1.js";import{s as U}from"./theme.82405b7f.js";import"./iframe.4500acf5.js";import"./variants.a6fa0423.js";import"./top-caret.655405b5.js";const k=a=>({type:"intent",payload:a});class L{constructor(t){var n,s;if(this.options=t,this.fetch=(s=t.fetchPonyfill)!=null?s:(n=globalThis.fetch)==null?void 0:n.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,n={}){var i,m;const s=new URL(t,this.options.url);n.params&&(s.search=n.params.toString());const r=await this.fetch(s,{method:(i=n.method)!=null?i:"GET",body:n.body?JSON.stringify(n.body):void 0,headers:{"content-type":"application/json",...(m=n.headers)!=null?m:{}}}),p=await r.json().catch(()=>null);if(!r.ok)throw A(r.status,r.statusText,p);return p}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class P{constructor(t={}){var n;this.traces=[],this.registerTraces((n=t.traces)!=null?n:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(n=>this.registerTrace(n)),this}async processTrace(t,n,s){const r={request:n,state:s.state,context:t};for(const p of s.trace){const i=this.traces.find(m=>m.canHandle(p));i&&(r.context=await i.handle(r,p))}return r.context}}class j{constructor(t){this.runtime=new L(t),this.trace=new P(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,n){const s=await this.runtime.interact(n);return this.trace.processTrace(t,n,s)}intent(t){return this.interact(t.context,{action:k(t.payload),sessionID:t.sessionID})}}const R=a=>t=>typeof t=="function"?{canHandle:n=>n.type===a,handle:t}:t,H=R("choice"),N=R("text"),Y=R("visual");var y=(a=>(a.USER="user",a.SYSTEM="system",a))(y||{});const B="https://general-runtime.voiceflow.com",K=()=>({messages:[]}),F=({url:a=B,versionID:t,...n})=>{const[s,r]=u.exports.useState([]),p=u.exports.useMemo(()=>b(),[]),i=u.exports.useMemo(()=>new j({...n,url:a}),[n.authorization]),m=async e=>{const o=await i.interact(K(),{versionID:t,sessionID:p,action:e});r(c=>[...c,{id:b(),type:y.SYSTEM,timestamp:new Date,...o}])},l=async(e,o)=>{r(c=>[...c,{id:b(),type:y.USER,message:e,timestamp:new Date}]),await m(o)};i.registerStep(N(({context:e},{payload:{message:o}})=>(e.messages.push({type:"text",text:o}),e))),i.registerStep(Y(({context:e},{payload:{image:o}})=>(e.messages.push({type:"image",url:o}),e))),i.registerStep(H(({context:e},{payload:{buttons:o}})=>(e.actions=o.map(({name:c,request:d})=>({label:c,onClick:()=>l(c,d)})),e))),i.registerStep({canHandle:({type:e})=>e==="cardV2",handle:({context:e},{payload:{title:o,imageUrl:c,description:d,buttons:h}})=>(e.messages.push({type:"card",title:o,description:d.text,image:c,actions:h.map(({name:f,request:S})=>({label:f,onClick:()=>l(f,S)}))}),e)}),i.registerStep({canHandle:({type:e})=>e==="carousel",handle:({context:e},{payload:{cards:o}})=>(e.messages.push({type:"carousel",cards:o.map(({title:c,description:d,imageUrl:h,buttons:f})=>({title:c,description:d.text,image:h,actions:f.map(({name:S,request:O})=>({label:S,onClick:()=>l(S,O)}))}))}),e)});const g=()=>r([]);return{turns:s,reset:g,launch:async()=>{s.length&&g(),await m({type:"launch",payload:null})},reply:async e=>l(e,{type:"text",payload:e})}},D=U("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",[`& ${E.Container}`]:{color:"$white"},[`& ${x.Container}`]:{height:800},[`& ${x.Dialog}`]:{flex:1},[`& ${M}`]:{margin:"auto"},[`
    & > ${E.Container},
    & > ${x.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),w=({assistant:a,versionID:t,authorization:n})=>{const[s,r]=u.exports.useState(!1),[p,i]=u.exports.useState(!0),m=u.exports.useMemo(()=>new Date,[]),l=F({versionID:t,authorization:n}),g=u.exports.useRef({}),v=()=>r(!0),T=()=>r(!1),e=async()=>{i(!0),await l.launch()},o=()=>{T(),i(!1)},c=d=>()=>{g.current[d]=!0};return u.exports.useEffect(()=>{l.launch()},[]),$.exports.createPortal(C(D,{children:s?C(x,{title:a.name,description:a.description,image:a.image,startTime:m,isRunning:p,isLoading:p&&!l.turns.length,onStart:e,onEnd:o,onSend:l.reply,onMinimize:T,children:l.turns.map(d=>W(d).with({type:y.USER},({id:h,...f})=>u.exports.createElement(z,{..._(f,["type"]),key:h})).with({type:y.SYSTEM},({id:h,...f})=>u.exports.createElement(V,{..._(f,["type"]),image:a.image,isAnimated:!g.current[h],onAnimationEnd:c(h),key:h})).exhaustive())}):C(E,{svg:"launch",onClick:v})}),document.body)},I=Object.assign(w,{Container:D});try{w.displayName="ChatWidget",w.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:w.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const yt={title:"Views/ChatWidget",component:I,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},G=a=>C(I,{...a}),J=G.bind({});J.args={};export{J as Default,yt as default};
//# sourceMappingURL=ChatWidget.story.f751afae.js.map
