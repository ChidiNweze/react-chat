import{r as d,j as C,a as $}from"./jsx-runtime.f6446faf.js";import{r as W}from"./index.75eb9397.js";import{c as z,a as U,C as g,K as V,U as k,o as v,S as L}from"./index.42f204fd.js";import"./index.e912f2f7.js";import{B as b}from"./index.d866b2c7.js";import"./index.9c4f88dc.js";import"./index.a853deb2.js";import"./index.590c1811.js";import"./index.df1abd92.js";import"./index.c63c7b4f.js";import"./index.752a0869.js";import"./index.db27d04f.js";import{L as j}from"./index.46481178.js";import"./index.15dfa989.js";import"./index.c735deb6.js";import"./index.b621b217.js";import"./index.4acbf77f.js";import{s as D}from"./theme.b4d422a8.js";import"./iframe.7dc377be.js";import"./variants.379a337b.js";import"./top-caret.46d165e1.js";const A=n=>({type:"intent",payload:n});class P{constructor(t){var a,r;if(this.options=t,this.fetch=(r=t.fetchPonyfill)!=null?r:(a=globalThis.fetch)==null?void 0:a.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,a={}){var o,l;const r=new URL(t,this.options.url);a.params&&(r.search=a.params.toString());const i=await this.fetch(r,{method:(o=a.method)!=null?o:"GET",body:a.body?JSON.stringify(a.body):void 0,headers:{"content-type":"application/json",...(l=a.headers)!=null?l:{}}}),p=await i.json().catch(()=>null);if(!i.ok)throw z(i.status,i.statusText,p);return p}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class Y{constructor(t={}){var a;this.traces=[],this.registerTraces((a=t.traces)!=null?a:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(a=>this.registerTrace(a)),this}async processTrace(t,a,r){const i={request:a,state:r.state,context:t};for(const p of r.trace){const o=this.traces.find(l=>l.canHandle(p));o&&(i.context=await o.handle(i,p))}return i.context}}class H{constructor(t){this.runtime=new P(t),this.trace=new Y(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,a){const r=await this.runtime.interact(a);return this.trace.processTrace(t,a,r)}intent(t){return this.interact(t.context,{action:A(t.payload),sessionID:t.sessionID})}}const E=n=>t=>typeof t=="function"?{canHandle:a=>a.type===n,handle:t}:t,N=E("choice"),B=E("text"),K=E("visual");var h=(n=>(n.USER="user",n.SYSTEM="system",n))(h||{});const F="https://general-runtime.voiceflow.com",G=()=>({messages:[]}),J=({url:n=F,versionID:t,...a})=>{const[r,i]=d.exports.useState([]),p=d.exports.useMemo(()=>U(),[]),o=d.exports.useMemo(()=>new H({...a,url:n}),[a.authorization]),l=async e=>{const s=await o.interact(G(),{versionID:t,sessionID:p,action:e});i(c=>[...c,{type:h.SYSTEM,timestamp:new Date,...s}])},m=async(e,s)=>{i(c=>[...c,{type:h.USER,message:e,timestamp:new Date}]),await l(s)};o.registerStep(B(({context:e},{payload:{message:s}})=>(e.messages.push({type:"text",text:s}),e))),o.registerStep(K(({context:e},{payload:{image:s}})=>(e.messages.push({type:"image",url:s}),e))),o.registerStep(N(({context:e},{payload:{buttons:s}})=>(e.actions=s.map(({name:c,request:u})=>({label:c,onClick:()=>m(c,u)})),e))),o.registerStep({canHandle:({type:e})=>e==="cardV2",handle:({context:e},{payload:{title:s,imageUrl:c,description:u,buttons:x}})=>(e.messages.push({type:"card",title:s,description:u.text,image:c,actions:x.map(({name:y,request:S})=>({label:y,onClick:()=>m(y,S)}))}),e)}),o.registerStep({canHandle:({type:e})=>e==="carousel",handle:({context:e},{payload:{cards:s}})=>(e.messages.push({type:"carousel",cards:s.map(({title:c,description:u,imageUrl:x,buttons:y})=>({title:c,description:u.text,image:x,actions:y.map(({name:S,request:O})=>({label:S,onClick:()=>m(S,O)}))}))}),e)});const f=()=>i([]);return{turns:r,reset:f,launch:async()=>{r.length&&f(),await l({type:"launch",payload:null})},sendMessage:async e=>{i(s=>[...s,{type:h.USER,message:e,timestamp:new Date}]),await l({type:"text",payload:e})}}},_=D("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",[`& ${b.Container}`]:{color:"$white"},[`& ${g.Container}`]:{height:800},[`& ${g.Dialog}`]:{flex:1},[`& ${j}`]:{margin:"auto"},[`
    & > ${b.Container},
    & > ${g.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),I=D(g.Timestamp,{padding:0}),w=({assistant:n,versionID:t,authorization:a})=>{const[r,i]=d.exports.useState(!1),[p,o]=d.exports.useState(!0),l=d.exports.useMemo(()=>new Date,[]),m=J({versionID:t,authorization:a}),f=()=>i(!0),T=()=>i(!1),R=async()=>{o(!0),await m.launch()},e=()=>{T(),o(!1)};return d.exports.useEffect(()=>{m.launch()},[]),W.exports.createPortal(C(_,{children:r?$(g,{title:n.name,description:n.description,image:n.image,startTime:l,isRunning:p,isLoading:p&&!m.turns.length,onStart:R,onEnd:e,onSend:m.sendMessage,onMinimize:T,children:[m.turns.map((s,c)=>V(s).with({type:h.USER},u=>d.exports.createElement(k,{...v(u,["type"]),key:c})).with({type:h.SYSTEM},u=>d.exports.createElement(L,{...v(u,["type"]),image:n.image,animated:!0,key:c})).exhaustive()),!p&&C(I,{children:"You have ended the chat"})]}):C(b,{svg:"launch",onClick:f})}),document.body)},M=Object.assign(w,{Container:_,ChatEnded:I});try{w.displayName="ChatWidget",w.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:w.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const Ct={title:"Views/ChatWidget",component:M,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},Q=n=>C(M,{...n}),X=Q.bind({});X.args={};export{X as Default,Ct as default};
//# sourceMappingURL=ChatWidget.story.447a3ea6.js.map
