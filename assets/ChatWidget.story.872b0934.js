import{r as d,j as S}from"./jsx-runtime.1f6943e2.js";import{r as I}from"./index.901a4373.js";import{c as M,a as O,C,K as W,U as $,o as R,S as V}from"./index.ac88f2e0.js";import{B as x}from"./index.467313e8.js";import{s as z}from"./theme.5a02fa41.js";import"./iframe.b604c220.js";import"./index.9a75f017.js";import"./index.f048caae.js";import"./variants.0d3867e1.js";import"./index.23b1ede7.js";import"./index.dc0f825f.js";import"./index.732c292c.js";import"./index.24b56b8b.js";import"./index.3ddf8879.js";import"./index.37ac5351.js";import"./index.873b0a06.js";import"./index.f9a3581c.js";const U=a=>({type:"intent",payload:a});class k{constructor(t){var e,i;if(this.options=t,this.fetch=(i=t.fetchPonyfill)!=null?i:(e=globalThis.fetch)==null?void 0:e.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,e={}){var n,l;const i=new URL(t,this.options.url);e.params&&(i.search=e.params.toString());const o=await this.fetch(i,{method:(n=e.method)!=null?n:"GET",body:e.body?JSON.stringify(e.body):void 0,headers:{"content-type":"application/json",...(l=e.headers)!=null?l:{}}}),p=await o.json().catch(()=>null);if(!o.ok)throw M(o.status,o.statusText,p);return p}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class A{constructor(t={}){var e;this.traces=[],this.registerTraces((e=t.traces)!=null?e:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(e=>this.registerTrace(e)),this}async processTrace(t,e,i){const o={request:e,state:i.state,context:t};for(const p of i.trace){const n=this.traces.find(l=>l.canHandle(p));n&&(o.context=await n.handle(o,p))}return o.context}}class P{constructor(t){this.runtime=new k(t),this.trace=new A(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,e){const i=await this.runtime.interact(e);return this.trace.processTrace(t,e,i)}intent(t){return this.interact(t.context,{action:U(t.payload),sessionID:t.sessionID})}}const b=a=>t=>typeof t=="function"?{canHandle:e=>e.type===a,handle:t}:t,j=b("choice"),H=b("text"),L=b("visual");var f=(a=>(a.USER="user",a.SYSTEM="system",a))(f||{});const N="https://general-runtime.voiceflow.com",Y=()=>({messages:[]}),B=({url:a=N,versionID:t,...e})=>{const[i,o]=d.exports.useState([]),p=d.exports.useMemo(()=>O(),[]),n=d.exports.useMemo(()=>new P({...e,url:a}),[e.authorization]),l=async s=>{const r=await n.interact(Y(),{versionID:t,sessionID:p,action:s});o(c=>[...c,{type:f.SYSTEM,timestamp:new Date,...r}])},h=async(s,r)=>{o(c=>[...c,{type:f.USER,message:s}]),await l(r)};return n.registerStep(H(({context:s},{payload:{message:r}})=>(s.messages.push({type:"text",text:r}),s))),n.registerStep(L(({context:s},{payload:{image:r}})=>(s.messages.push({type:"image",url:r}),s))),n.registerStep(j(({context:s},{payload:{buttons:r}})=>(s.actions=r.map(({name:c,request:u})=>({label:c,onClick:()=>h(c,u)})),s))),n.registerStep({canHandle:({type:s})=>s==="cardV2",handle:({context:s},{payload:{title:r,imageUrl:c,description:u,buttons:m}})=>(s.messages.push({type:"card",title:r,description:u.text,image:c,actions:m.map(({name:g,request:y})=>({label:g,onClick:()=>h(g,y)}))}),s)}),n.registerStep({canHandle:({type:s})=>s==="carousel",handle:({context:s},{payload:{cards:r}})=>(s.messages.push({type:"carousel",cards:r.map(({title:c,description:u,imageUrl:m,buttons:g})=>({title:c,description:u.text,image:m,actions:g.map(({name:y,request:D})=>({label:y,onClick:()=>h(y,D)}))}))}),s)}),{turns:i,launch:async()=>l({type:"launch",payload:null}),sendMessage:async s=>l({type:"text",payload:s})}},v=z("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased",[`& ${x.Container}`]:{color:"$white"},[`& ${C.Container}`]:{height:800},[`& ${C.Dialog}`]:{flex:1},[`
    & > ${x.Container},
    & > ${C.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),T=({assistant:a,versionID:t,authorization:e})=>{const[i,o]=d.exports.useState(!1),[p,n]=d.exports.useState(!1),l=d.exports.useMemo(()=>new Date,[]),h=B({versionID:t,authorization:e}),E=()=>o(!0),w=()=>o(!1),s=async()=>{n(!0),await h.launch()},r=()=>{w(),n(!1)};return I.exports.createPortal(S(v,{children:i?S(C,{title:a.name,description:a.description,image:a.image,startTime:l,isRunning:p,onStart:s,onEnd:r,onSend:h.sendMessage,onMinimize:w,children:h.turns.map((c,u)=>W(c).with({type:f.USER},m=>d.exports.createElement($,{...R(m,["type"]),key:u})).with({type:f.SYSTEM},m=>d.exports.createElement(V,{...R(m,["type"]),image:a.image,key:u})).exhaustive())}):S(x,{svg:"launch",onClick:E})}),document.body)},_=Object.assign(T,{Container:v});try{T.displayName="ChatWidget",T.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:T.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const ut={title:"Views/ChatWidget",component:_,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},K=a=>S(_,{...a}),F=K.bind({});F.args={};export{F as Default,ut as default};
//# sourceMappingURL=ChatWidget.story.872b0934.js.map
