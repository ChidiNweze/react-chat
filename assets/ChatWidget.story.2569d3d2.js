import{r as u,j as S}from"./jsx-runtime.6525d54e.js";import{r as I}from"./index.82e23ba0.js";import{c as M,a as O,C,K as W,U as $,o as R,S as U}from"./index.4b6fe901.js";import{B as x}from"./index.6da06241.js";import{s as V}from"./theme.5e87f1aa.js";import"./iframe.484141be.js";import"./index.9f2e38f1.js";import"./index.5207ddff.js";import"./variants.6a95857c.js";import"./index.a1d28dce.js";import"./index.84ea9afc.js";import"./index.d1477718.js";import"./top-caret.9472116e.js";import"./index.d86dbaa4.js";import"./index.0de111c6.js";import"./index.8d1bbd9a.js";import"./index.a4e52f35.js";import"./index.1a91c83a.js";import"./index.cdb0142b.js";import"./index.2bcb9f8f.js";const z=n=>({type:"intent",payload:n});class k{constructor(t){var a,o;if(this.options=t,this.fetch=(o=t.fetchPonyfill)!=null?o:(a=globalThis.fetch)==null?void 0:a.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,a={}){var r,p;const o=new URL(t,this.options.url);a.params&&(o.search=a.params.toString());const i=await this.fetch(o,{method:(r=a.method)!=null?r:"GET",body:a.body?JSON.stringify(a.body):void 0,headers:{"content-type":"application/json",...(p=a.headers)!=null?p:{}}}),l=await i.json().catch(()=>null);if(!i.ok)throw M(i.status,i.statusText,l);return l}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class A{constructor(t={}){var a;this.traces=[],this.registerTraces((a=t.traces)!=null?a:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(a=>this.registerTrace(a)),this}async processTrace(t,a,o){const i={request:a,state:o.state,context:t};for(const l of o.trace){const r=this.traces.find(p=>p.canHandle(l));r&&(i.context=await r.handle(i,l))}return i.context}}class P{constructor(t){this.runtime=new k(t),this.trace=new A(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,a){const o=await this.runtime.interact(a);return this.trace.processTrace(t,a,o)}intent(t){return this.interact(t.context,{action:z(t.payload),sessionID:t.sessionID})}}const b=n=>t=>typeof t=="function"?{canHandle:a=>a.type===n,handle:t}:t,j=b("choice"),H=b("text"),L=b("visual");var f=(n=>(n.USER="user",n.SYSTEM="system",n))(f||{});const N="https://general-runtime.voiceflow.com",Y=()=>({messages:[]}),B=({url:n=N,versionID:t,...a})=>{const[o,i]=u.exports.useState([]),l=u.exports.useMemo(()=>O(),[]),r=u.exports.useMemo(()=>new P({...a,url:n}),[a.authorization]),p=async e=>{const s=await r.interact(Y(),{versionID:t,sessionID:l,action:e});i(c=>[...c,{type:f.SYSTEM,timestamp:new Date,...s}])},d=async(e,s)=>{i(c=>[...c,{type:f.USER,message:e,timestamp:new Date}]),await p(s)};return r.registerStep(H(({context:e},{payload:{message:s}})=>(e.messages.push({type:"text",text:s}),e))),r.registerStep(L(({context:e},{payload:{image:s}})=>(e.messages.push({type:"image",url:s}),e))),r.registerStep(j(({context:e},{payload:{buttons:s}})=>(e.actions=s.map(({name:c,request:m})=>({label:c,onClick:()=>d(c,m)})),e))),r.registerStep({canHandle:({type:e})=>e==="cardV2",handle:({context:e},{payload:{title:s,imageUrl:c,description:m,buttons:h}})=>(e.messages.push({type:"card",title:s,description:m.text,image:c,actions:h.map(({name:g,request:y})=>({label:g,onClick:()=>d(g,y)}))}),e)}),r.registerStep({canHandle:({type:e})=>e==="carousel",handle:({context:e},{payload:{cards:s}})=>(e.messages.push({type:"carousel",cards:s.map(({title:c,description:m,imageUrl:h,buttons:g})=>({title:c,description:m.text,image:h,actions:g.map(({name:y,request:_})=>({label:y,onClick:()=>d(y,_)}))}))}),e)}),{turns:o,launch:async()=>p({type:"launch",payload:null}),sendMessage:async e=>{i(s=>[...s,{type:f.USER,message:e,timestamp:new Date}]),await p({type:"text",payload:e})}}},v=V("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased",[`& ${x.Container}`]:{color:"$white"},[`& ${C.Container}`]:{height:800},[`& ${C.Dialog}`]:{flex:1},[`
    & > ${x.Container},
    & > ${C.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),w=({assistant:n,versionID:t,authorization:a})=>{const[o,i]=u.exports.useState(!1),[l,r]=u.exports.useState(!1),p=u.exports.useMemo(()=>new Date,[]),d=B({versionID:t,authorization:a}),E=()=>i(!0),T=()=>i(!1),e=async()=>{r(!0),await d.launch()},s=()=>{T(),r(!1)};return I.exports.createPortal(S(v,{children:o?S(C,{title:n.name,description:n.description,image:n.image,startTime:p,isRunning:l,onStart:e,onEnd:s,onSend:d.sendMessage,onMinimize:T,children:d.turns.map((c,m)=>W(c).with({type:f.USER},h=>u.exports.createElement($,{...R(h,["type"]),key:m})).with({type:f.SYSTEM},h=>u.exports.createElement(U,{...R(h,["type"]),image:n.image,animated:!0,key:m})).exhaustive())}):S(x,{svg:"launch",onClick:E})}),document.body)},D=Object.assign(w,{Container:v});try{w.displayName="ChatWidget",w.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:w.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const ht={title:"Views/ChatWidget",component:D,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},K=n=>S(D,{...n}),F=K.bind({});F.args={};export{F as Default,ht as default};
//# sourceMappingURL=ChatWidget.story.2569d3d2.js.map
