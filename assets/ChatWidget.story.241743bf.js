import{r as d,j as C}from"./jsx-runtime.503516e4.js";import{r as $}from"./index.02fd5b66.js";import{c as A,C as T,K as W,U as z,o as _,S as V}from"./index.9362e98a.js";import"./index.e24b3ff4.js";import{B as v}from"./index.f0fb03c4.js";import"./index.5651cac5.js";import"./index.93dfc771.js";import"./index.ec2dee4a.js";import{c as E}from"./index.eeaf2df2.js";import"./index.1d6d3abb.js";import"./index.87d4c893.js";import"./index.778e77b9.js";import{L as U}from"./index.ee160c1a.js";import"./index.4f40036b.js";import"./index.cdd072d8.js";import"./index.5acc641a.js";import"./index.48ace947.js";import{s as k}from"./theme.9c2e6479.js";import"./iframe.14cb0103.js";import"./variants.547f112b.js";import"./top-caret.d1efc1ed.js";const L=a=>({type:"intent",payload:a});class M{constructor(t){var n,s;if(this.options=t,this.fetch=(s=t.fetchPonyfill)!=null?s:(n=globalThis.fetch)==null?void 0:n.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,n={}){var r,l;const s=new URL(t,this.options.url);n.params&&(s.search=n.params.toString());const i=await this.fetch(s,{method:(r=n.method)!=null?r:"GET",body:n.body?JSON.stringify(n.body):void 0,headers:{"content-type":"application/json",...(l=n.headers)!=null?l:{}}}),m=await i.json().catch(()=>null);if(!i.ok)throw A(i.status,i.statusText,m);return m}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class P{constructor(t={}){var n;this.traces=[],this.registerTraces((n=t.traces)!=null?n:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(n=>this.registerTrace(n)),this}async processTrace(t,n,s){const i={request:n,state:s.state,context:t};for(const m of s.trace){const r=this.traces.find(l=>l.canHandle(m));r&&(i.context=await r.handle(i,m))}return i.context}}class j{constructor(t){this.runtime=new M(t),this.trace=new P(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,n){const s=await this.runtime.interact(n);return this.trace.processTrace(t,n,s)}intent(t){return this.interact(t.context,{action:L(t.payload),sessionID:t.sessionID})}}const R=a=>t=>typeof t=="function"?{canHandle:n=>n.type===a,handle:t}:t,H=R("choice"),N=R("text"),Y=R("visual");var S=(a=>(a.USER="user",a.SYSTEM="system",a))(S||{});const B="https://general-runtime.voiceflow.com",K=()=>({messages:[]}),F=({url:a=B,versionID:t,...n})=>{const[s,i]=d.exports.useState([]),m=d.exports.useMemo(()=>E(),[]),r=d.exports.useMemo(()=>new j({...n,url:a}),[n.authorization]),l=async e=>{const o=await r.interact(K(),{versionID:t,sessionID:m,action:e});i(c=>[...c,{id:E(),type:S.SYSTEM,timestamp:new Date,...o}])},g=async(e,o)=>{i(c=>[...c,{id:E(),type:S.USER,message:e,timestamp:new Date}]),await l(o)};r.registerStep(N(({context:e},{payload:{message:o}})=>(e.messages.push({type:"text",text:o}),e))),r.registerStep(Y(({context:e},{payload:{image:o}})=>(e.messages.push({type:"image",url:o}),e))),r.registerStep(H(({context:e},{payload:{buttons:o}})=>(e.actions=o.map(({name:c,request:f})=>({label:c,onClick:()=>g(c,f)})),e))),r.registerStep({canHandle:({type:e})=>e==="cardV2",handle:({context:e},{payload:{title:o,imageUrl:c,description:f,buttons:y}})=>(e.messages.push({type:"card",title:o,description:f.text,image:c,actions:y.map(({name:p,request:u})=>({label:p,onClick:()=>g(p,u)}))}),e)}),r.registerStep({canHandle:({type:e})=>e==="carousel",handle:({context:e},{payload:{cards:o}})=>(e.messages.push({type:"carousel",cards:o.map(({title:c,description:f,imageUrl:y,buttons:p})=>({title:c,description:f.text,image:y,actions:p.map(({name:u,request:O})=>({label:u,onClick:()=>g(u,O)}))}))}),e)});const h=()=>i([]);return{turns:s,reset:h,launch:async()=>{s.length&&h(),await l({type:"launch",payload:null})},reply:async e=>g(e,{type:"text",payload:e})}},D=k("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",[`& ${v.Container}`]:{color:"$white"},[`& ${T.Container}`]:{height:800},[`& ${T.Dialog}`]:{flex:1},[`& ${U}`]:{margin:"auto"},[`
    & > ${v.Container},
    & > ${T.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),w=({assistant:a,versionID:t,authorization:n})=>{const[s,i]=d.exports.useState(!1),[m,r]=d.exports.useState(!1),[l,g]=d.exports.useState(null),h=F({versionID:t,authorization:n}),x=d.exports.useRef({}),b=()=>i(!1),e=async()=>{g({startTime:new Date}),r(!1),await h.launch()},o=async()=>{i(!0),l||await e()},c=()=>{b(),r(!0)},f=y=>()=>{x.current[y]=!0};return $.exports.createPortal(C(D,{children:s&&!!l?C(T,{title:a.name,description:a.description,image:a.image,startTime:l.startTime,hasEnded:m,isLoading:!h.turns.length,onStart:e,onEnd:c,onSend:h.reply,onMinimize:b,children:h.turns.map(y=>W(y).with({type:S.USER},({id:p,...u})=>d.exports.createElement(z,{..._(u,["type"]),key:p})).with({type:S.SYSTEM},({id:p,...u})=>d.exports.createElement(V,{..._(u,["type"]),image:a.image,isAnimated:!x.current[p],onAnimationEnd:f(p),key:p})).exhaustive())}):C(v,{svg:"launch",onClick:o})}),document.body)},I=Object.assign(w,{Container:D});try{w.displayName="ChatWidget",w.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:w.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const gt={title:"Views/ChatWidget",component:I,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},G=a=>C(I,{...a}),J=G.bind({});J.args={};export{J as Default,gt as default};
//# sourceMappingURL=ChatWidget.story.241743bf.js.map
