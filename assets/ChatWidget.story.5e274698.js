import{r as m,j as S}from"./jsx-runtime.87ea2512.js";import{r as I}from"./index.8c7ac538.js";import{c as M,a as O,C,K as W,U as $,o as R,S as V}from"./index.5a3b0f3c.js";import{B as x}from"./index.f4be8c19.js";import{s as z}from"./theme.d45d6b19.js";import"./iframe.6902c6f3.js";import"./index.152c1a83.js";import"./index.dd599116.js";import"./variants.c18479de.js";import"./index.e7da8e75.js";import"./index.7151dc09.js";import"./index.a62cb377.js";import"./index.932851fc.js";import"./index.e7f379df.js";import"./index.618026db.js";import"./index.e0c4959c.js";import"./index.545d6b65.js";import"./index.1e670adb.js";const U=n=>({type:"intent",payload:n});class k{constructor(t){var e,i;if(this.options=t,this.fetch=(i=t.fetchPonyfill)!=null?i:(e=globalThis.fetch)==null?void 0:e.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,e={}){var s,l;const i=new URL(t,this.options.url);e.params&&(i.search=e.params.toString());const o=await this.fetch(i,{method:(s=e.method)!=null?s:"GET",body:e.body?JSON.stringify(e.body):void 0,headers:{"content-type":"application/json",...(l=e.headers)!=null?l:{}}}),p=await o.json().catch(()=>null);if(!o.ok)throw M(o.status,o.statusText,p);return p}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class A{constructor(t={}){var e;this.traces=[],this.registerTraces((e=t.traces)!=null?e:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(e=>this.registerTrace(e)),this}async processTrace(t,e,i){const o={request:e,state:i.state,context:t};for(const p of i.trace){const s=this.traces.find(l=>l.canHandle(p));s&&(o.context=await s.handle(o,p))}return o.context}}class P{constructor(t){this.runtime=new k(t),this.trace=new A(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,e){const i=await this.runtime.interact(e);return this.trace.processTrace(t,e,i)}intent(t){return this.interact(t.context,{action:U(t.payload),sessionID:t.sessionID})}}const b=n=>t=>typeof t=="function"?{canHandle:e=>e.type===n,handle:t}:t,j=b("choice"),H=b("text"),L=b("visual");var f=(n=>(n.USER="user",n.SYSTEM="system",n))(f||{});const N="https://general-runtime.voiceflow.com",Y=()=>({messages:[]}),B=({url:n=N,versionID:t,...e})=>{const[i,o]=m.exports.useState([]),p=m.exports.useMemo(()=>O(),[]),s=m.exports.useMemo(()=>new P({...e,url:n}),[e.authorization]),l=async a=>{const r=await s.interact(Y(),{versionID:t,sessionID:p,action:a});o(c=>[...c,{type:f.SYSTEM,timestamp:new Date,...r}])},d=async(a,r)=>{o(c=>[...c,{type:f.USER,message:a}]),await l(r)};return s.registerStep(H(({context:a},{payload:{message:r}})=>(a.messages.push({type:"text",text:r}),a))),s.registerStep(L(({context:a},{payload:{image:r}})=>(a.messages.push({type:"image",url:r}),a))),s.registerStep(j(({context:a},{payload:{buttons:r}})=>(a.actions=r.map(({name:c,request:u})=>({label:c,onClick:()=>d(c,u)})),a))),s.registerStep({canHandle:({type:a})=>a==="cardV2",handle:({context:a},{payload:{title:r,imageUrl:c,description:u,buttons:h}})=>(a.messages.push({type:"card",title:r,description:u.text,image:c,actions:h.map(({name:g,request:y})=>({label:g,onClick:()=>d(g,y)}))}),a)}),s.registerStep({canHandle:({type:a})=>a==="carousel",handle:({context:a},{payload:{cards:r}})=>(a.messages.push({type:"carousel",cards:r.map(({title:c,description:u,imageUrl:h,buttons:g})=>({title:c,description:u.text,image:h,actions:g.map(({name:y,request:D})=>({label:y,onClick:()=>d(y,D)}))}))}),a)}),{turns:i,launch:async()=>l({type:"launch",payload:null}),sendMessage:async a=>l({type:"text",payload:a})}},v=z("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased",[`& ${x.Container}`]:{color:"$white"},[`& ${C.Container}`]:{height:800},[`& ${C.Dialog}`]:{flex:1},[`
    & > ${x.Container},
    & > ${C.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),T=({assistant:n,versionID:t,authorization:e})=>{const[i,o]=m.exports.useState(!1),[p,s]=m.exports.useState(!1),l=m.exports.useMemo(()=>new Date,[]),d=B({versionID:t,authorization:e}),E=()=>o(!0),w=()=>o(!1),a=async()=>{s(!0),await d.launch()},r=()=>{w(),s(!1)};return I.exports.createPortal(S(v,{children:i?S(C,{title:n.name,description:n.description,image:n.image,startTime:l,isRunning:p,onStart:a,onEnd:r,onSend:d.sendMessage,onMinimize:w,children:d.turns.map((c,u)=>W(c).with({type:f.USER},h=>m.exports.createElement($,{...R(h,["type"]),key:u})).with({type:f.SYSTEM},h=>m.exports.createElement(V,{...R(h,["type"]),image:n.image,animated:!0,key:u})).exhaustive())}):S(x,{svg:"launch",onClick:E})}),document.body)},_=Object.assign(T,{Container:v});try{T.displayName="ChatWidget",T.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:T.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const mt={title:"Views/ChatWidget",component:_,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},K=n=>S(_,{...n}),F=K.bind({});F.args={};export{F as Default,mt as default};
//# sourceMappingURL=ChatWidget.story.5e274698.js.map
