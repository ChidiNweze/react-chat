import{r as d,j as S}from"./jsx-runtime.09644d41.js";import{r as I}from"./index.950e789f.js";import{c as M,a as O,C,K as W,U as $,o as R,S as U}from"./index.815b632b.js";import{B as x}from"./index.6c13330e.js";import{s as V}from"./theme.4bcc7390.js";import"./iframe.63319022.js";import"./index.1daadfda.js";import"./index.753f2e59.js";import"./variants.dc6e585d.js";import"./index.50b38705.js";import"./index.96a99051.js";import"./index.040b28db.js";import"./index.4ef47d08.js";import"./index.73d968b2.js";import"./index.69e9037b.js";import"./index.8bf1a485.js";import"./index.e5ec34d1.js";import"./index.d622899f.js";const z=n=>({type:"intent",payload:n});class k{constructor(t){var a,o;if(this.options=t,this.fetch=(o=t.fetchPonyfill)!=null?o:(a=globalThis.fetch)==null?void 0:a.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,a={}){var r,p;const o=new URL(t,this.options.url);a.params&&(o.search=a.params.toString());const i=await this.fetch(o,{method:(r=a.method)!=null?r:"GET",body:a.body?JSON.stringify(a.body):void 0,headers:{"content-type":"application/json",...(p=a.headers)!=null?p:{}}}),l=await i.json().catch(()=>null);if(!i.ok)throw M(i.status,i.statusText,l);return l}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class A{constructor(t={}){var a;this.traces=[],this.registerTraces((a=t.traces)!=null?a:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(a=>this.registerTrace(a)),this}async processTrace(t,a,o){const i={request:a,state:o.state,context:t};for(const l of o.trace){const r=this.traces.find(p=>p.canHandle(l));r&&(i.context=await r.handle(i,l))}return i.context}}class P{constructor(t){this.runtime=new k(t),this.trace=new A(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,a){const o=await this.runtime.interact(a);return this.trace.processTrace(t,a,o)}intent(t){return this.interact(t.context,{action:z(t.payload),sessionID:t.sessionID})}}const b=n=>t=>typeof t=="function"?{canHandle:a=>a.type===n,handle:t}:t,j=b("choice"),H=b("text"),L=b("visual");var f=(n=>(n.USER="user",n.SYSTEM="system",n))(f||{});const N="https://general-runtime.voiceflow.com",Y=()=>({messages:[]}),B=({url:n=N,versionID:t,...a})=>{const[o,i]=d.exports.useState([]),l=d.exports.useMemo(()=>O(),[]),r=d.exports.useMemo(()=>new P({...a,url:n}),[a.authorization]),p=async e=>{const s=await r.interact(Y(),{versionID:t,sessionID:l,action:e});i(c=>[...c,{type:f.SYSTEM,timestamp:new Date,...s}])},m=async(e,s)=>{i(c=>[...c,{type:f.USER,message:e}]),await p(s)};return r.registerStep(H(({context:e},{payload:{message:s}})=>(e.messages.push({type:"text",text:s}),e))),r.registerStep(L(({context:e},{payload:{image:s}})=>(e.messages.push({type:"image",url:s}),e))),r.registerStep(j(({context:e},{payload:{buttons:s}})=>(e.actions=s.map(({name:c,request:u})=>({label:c,onClick:()=>m(c,u)})),e))),r.registerStep({canHandle:({type:e})=>e==="cardV2",handle:({context:e},{payload:{title:s,imageUrl:c,description:u,buttons:h}})=>(e.messages.push({type:"card",title:s,description:u.text,image:c,actions:h.map(({name:g,request:y})=>({label:g,onClick:()=>m(g,y)}))}),e)}),r.registerStep({canHandle:({type:e})=>e==="carousel",handle:({context:e},{payload:{cards:s}})=>(e.messages.push({type:"carousel",cards:s.map(({title:c,description:u,imageUrl:h,buttons:g})=>({title:c,description:u.text,image:h,actions:g.map(({name:y,request:D})=>({label:y,onClick:()=>m(y,D)}))}))}),e)}),{turns:o,launch:async()=>p({type:"launch",payload:null}),sendMessage:async e=>{i(s=>[...s,{type:f.USER,message:e}]),await p({type:"text",payload:e})}}},v=V("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased",[`& ${x.Container}`]:{color:"$white"},[`& ${C.Container}`]:{height:800},[`& ${C.Dialog}`]:{flex:1},[`
    & > ${x.Container},
    & > ${C.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),T=({assistant:n,versionID:t,authorization:a})=>{const[o,i]=d.exports.useState(!1),[l,r]=d.exports.useState(!1),p=d.exports.useMemo(()=>new Date,[]),m=B({versionID:t,authorization:a}),E=()=>i(!0),w=()=>i(!1),e=async()=>{r(!0),await m.launch()},s=()=>{w(),r(!1)};return I.exports.createPortal(S(v,{children:o?S(C,{title:n.name,description:n.description,image:n.image,startTime:p,isRunning:l,onStart:e,onEnd:s,onSend:m.sendMessage,onMinimize:w,children:m.turns.map((c,u)=>W(c).with({type:f.USER},h=>d.exports.createElement($,{...R(h,["type"]),key:u})).with({type:f.SYSTEM},h=>d.exports.createElement(U,{...R(h,["type"]),image:n.image,animated:!0,key:u})).exhaustive())}):S(x,{svg:"launch",onClick:E})}),document.body)},_=Object.assign(T,{Container:v});try{T.displayName="ChatWidget",T.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:T.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const dt={title:"Views/ChatWidget",component:_,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},K=n=>S(_,{...n}),F=K.bind({});F.args={};export{F as Default,dt as default};
//# sourceMappingURL=ChatWidget.story.d967ec42.js.map
