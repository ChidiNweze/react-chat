import{r as h,j as S}from"./jsx-runtime.7893253a.js";import{r as M}from"./index.47eea9c6.js";import{c as O,a as $,C as w,K as W,U as z,o as v,S as U}from"./index.c3409d1a.js";import"./index.02107759.js";import{B as b}from"./index.53caf72f.js";import"./index.490cfc41.js";import"./index.aa82c9a2.js";import"./index.94a62d6e.js";import"./index.b22857e1.js";import"./index.69908e9e.js";import"./index.ecf1a3cf.js";import"./index.2e0b22b8.js";import{L as V}from"./index.4fb69bc7.js";import"./index.b868953d.js";import"./index.076e74fc.js";import"./index.28b8bb22.js";import"./index.08fca909.js";import{s as k}from"./theme.e25cef70.js";import"./iframe.57439ab4.js";import"./variants.cb132077.js";import"./top-caret.c274a41e.js";const L=n=>({type:"intent",payload:n});class A{constructor(t){var a,r;if(this.options=t,this.fetch=(r=t.fetchPonyfill)!=null?r:(a=globalThis.fetch)==null?void 0:a.bind(globalThis),!this.fetch)throw new TypeError("fetch implementation was not provided and a global fetch was not available")}async send(t,a={}){var o,l;const r=new URL(t,this.options.url);a.params&&(r.search=a.params.toString());const i=await this.fetch(r,{method:(o=a.method)!=null?o:"GET",body:a.body?JSON.stringify(a.body):void 0,headers:{"content-type":"application/json",...(l=a.headers)!=null?l:{}}}),p=await i.json().catch(()=>null);if(!i.ok)throw O(i.status,i.statusText,p);return p}async interact(t){return this.send(`state/${t.versionID}/user/${t.sessionID}/interact`,{method:"POST",body:{action:t.action,config:t.config},headers:{authorization:this.options.authorization},params:new URLSearchParams({verbose:"true"})})}}class P{constructor(t={}){var a;this.traces=[],this.registerTraces((a=t.traces)!=null?a:[])}registerTrace(t){return this.traces.push(t),this}registerTraces(t){return t.forEach(a=>this.registerTrace(a)),this}async processTrace(t,a,r){const i={request:a,state:r.state,context:t};for(const p of r.trace){const o=this.traces.find(l=>l.canHandle(p));o&&(i.context=await o.handle(i,p))}return i.context}}class j{constructor(t){this.runtime=new A(t),this.trace=new P(t)}registerStep(t){return this.trace.registerTrace(t),this}async interact(t,a){const r=await this.runtime.interact(a);return this.trace.processTrace(t,a,r)}intent(t){return this.interact(t.context,{action:L(t.payload),sessionID:t.sessionID})}}const E=n=>t=>typeof t=="function"?{canHandle:a=>a.type===n,handle:t}:t,H=E("choice"),N=E("text"),Y=E("visual");var d=(n=>(n.USER="user",n.SYSTEM="system",n))(d||{});const B="https://general-runtime.voiceflow.com",K=()=>({messages:[]}),F=({url:n=B,versionID:t,...a})=>{const[r,i]=h.exports.useState([]),p=h.exports.useMemo(()=>$(),[]),o=h.exports.useMemo(()=>new j({...a,url:n}),[a.authorization]),l=async e=>{const s=await o.interact(K(),{versionID:t,sessionID:p,action:e});i(c=>[...c,{type:d.SYSTEM,timestamp:new Date,...s}])},m=async(e,s)=>{i(c=>[...c,{type:d.USER,message:e,timestamp:new Date}]),await l(s)};o.registerStep(N(({context:e},{payload:{message:s}})=>(e.messages.push({type:"text",text:s}),e))),o.registerStep(Y(({context:e},{payload:{image:s}})=>(e.messages.push({type:"image",url:s}),e))),o.registerStep(H(({context:e},{payload:{buttons:s}})=>(e.actions=s.map(({name:c,request:u})=>({label:c,onClick:()=>m(c,u)})),e))),o.registerStep({canHandle:({type:e})=>e==="cardV2",handle:({context:e},{payload:{title:s,imageUrl:c,description:u,buttons:x}})=>(e.messages.push({type:"card",title:s,description:u.text,image:c,actions:x.map(({name:f,request:y})=>({label:f,onClick:()=>m(f,y)}))}),e)}),o.registerStep({canHandle:({type:e})=>e==="carousel",handle:({context:e},{payload:{cards:s}})=>(e.messages.push({type:"carousel",cards:s.map(({title:c,description:u,imageUrl:x,buttons:f})=>({title:c,description:u.text,image:x,actions:f.map(({name:y,request:I})=>({label:y,onClick:()=>m(y,I)}))}))}),e)});const g=()=>i([]);return{turns:r,reset:g,launch:async()=>{r.length&&g(),await l({type:"launch",payload:null})},sendMessage:async e=>{i(s=>[...s,{type:d.USER,message:e,timestamp:new Date}]),await l({type:"text",payload:e})}}},D=k("div",{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:10,"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",[`& ${b.Container}`]:{color:"$white"},[`& ${w.Container}`]:{height:800},[`& ${w.Dialog}`]:{flex:1},[`& ${V}`]:{margin:"auto"},[`
    & > ${b.Container},
    & > ${w.Container}
  `]:{position:"absolute",right:"$6",bottom:"$6"}}),C=({assistant:n,versionID:t,authorization:a})=>{const[r,i]=h.exports.useState(!1),[p,o]=h.exports.useState(!0),l=h.exports.useMemo(()=>new Date,[]),m=F({versionID:t,authorization:a}),g=()=>i(!0),T=()=>i(!1),R=async()=>{o(!0),await m.launch()},e=()=>{T(),o(!1)};return h.exports.useEffect(()=>{m.launch()},[]),M.exports.createPortal(S(D,{children:r?S(w,{title:n.name,description:n.description,image:n.image,startTime:l,isRunning:p,isLoading:p&&!m.turns.length,onStart:R,onEnd:e,onSend:m.sendMessage,onMinimize:T,children:m.turns.map((s,c)=>W(s).with({type:d.USER},u=>h.exports.createElement(z,{...v(u,["type"]),key:c})).with({type:d.SYSTEM},u=>h.exports.createElement(U,{...v(u,["type"]),image:n.image,animated:!0,key:c})).exhaustive())}):S(b,{svg:"launch",onClick:g})}),document.body)},_=Object.assign(C,{Container:D});try{C.displayName="ChatWidget",C.__docgenInfo={description:"",displayName:"ChatWidget",props:{assistant:{defaultValue:null,description:"",name:"assistant",required:!0,type:{name:"{ name: string; description: string; image: string; }"}},versionID:{defaultValue:null,description:"",name:"versionID",required:!0,type:{name:"string"}},authorization:{defaultValue:null,description:"",name:"authorization",required:!0,type:{name:"string"}},fetchPonyfill:{defaultValue:null,description:"A ponyfill to use for `fetch()`.\nDefaults to the global `fetch()`.",name:"fetchPonyfill",required:!1,type:{name:"FetchFn"}},traces:{defaultValue:null,description:"",name:"traces",required:!1,type:{name:"TraceDeclaration<RuntimeContext, any>[]"}}}},typeof STORYBOOK_REACT_CLASSES<"u"&&(STORYBOOK_REACT_CLASSES["src/views/ChatWidget/index.tsx#ChatWidget"]={docgenInfo:C.__docgenInfo,name:"ChatWidget",path:"src/views/ChatWidget/index.tsx#ChatWidget"})}catch{}const yt={title:"Views/ChatWidget",component:_,args:{versionID:"",authorization:"",assistant:{name:"Assistant Name",image:"https://source.unsplash.com/random/72x72",description:"Voiceflow's virtual assistant is here to help."}}},G=n=>S(_,{...n}),J=G.bind({});J.args={};export{J as Default,yt as default};
//# sourceMappingURL=ChatWidget.story.dbc4dc00.js.map
